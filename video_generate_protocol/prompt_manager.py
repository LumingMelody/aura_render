# prompt_manager.py
"""
è§†é¢‘ç”Ÿæˆæç¤ºè¯ç®¡ç†å™¨
ç®¡ç†å’Œåˆ†å‘å„ä¸ªé˜¶æ®µçš„ä¸“ä¸šæç¤ºè¯
"""

from typing import Dict, Optional, Any
import json
import os
from pathlib import Path


class PromptManager:
    """
    åŠ¨æ€æç¤ºè¯ç®¡ç†ç³»ç»Ÿ
    æ ¹æ®è§†é¢‘ç”Ÿæˆçš„ä¸åŒé˜¶æ®µå’ŒèŠ‚ç‚¹ç±»åž‹ï¼Œæä¾›ç›¸åº”çš„ä¸“ä¸šæç¤ºè¯
    """

    def __init__(self):
        """åˆå§‹åŒ–æç¤ºè¯ç®¡ç†å™¨ï¼ŒåŠ è½½æ‰€æœ‰é˜¶æ®µçš„æç¤ºè¯"""
        self.stage_prompts = self._load_stage_prompts()
        self.node_to_stage_mapping = self._create_node_mapping()

    def _load_stage_prompts(self) -> Dict[str, str]:
        """åŠ è½½æ‰€æœ‰12ä¸ªé˜¶æ®µçš„ä¸“ä¸šæç¤ºè¯"""
        return {
            # é˜¶æ®µ1ï¼šå…¨å±€äº§å“
            "product_description": """
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªäº§å“æè¿°ä¸“å®¶ï¼Œæ“…é•¿æ ¹æ®ä¸åŒäº§å“ç»™å‡ºç®€æ´ä¸”ç²¾å‡†çš„æè¿°ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£äº§å“ç‰¹ç‚¹ã€‚

## æŠ€èƒ½
### æŠ€èƒ½ 1: æè¿°äº§å“
1. å½“ç”¨æˆ·è¾“å…¥æŸä¸€äº§å“æ—¶ï¼Œä½¿ç”¨å·¥å…·æœç´¢è¯¥äº§å“ç›¸å…³ä¿¡æ¯ã€‚
2. åŸºäºŽæœç´¢èŽ·å–çš„ä¿¡æ¯ï¼Œç”Ÿæˆå¯¹è¯¥äº§å“çš„ç®€å•æè¿°ï¼Œçªå‡ºå…¶å…³é”®ç‰¹æ€§å’Œä¸»è¦ç”¨é€”ã€‚

## é™åˆ¶:
- åªå›´ç»•ç”¨æˆ·è¾“å…¥çš„äº§å“è¿›è¡Œæè¿°ï¼Œä¸å›žç­”ä¸Žäº§å“æè¿°æ— å…³çš„è¯é¢˜ã€‚
- æè¿°éœ€ç®€æ´æ˜Žäº†ï¼Œé¿å…è¿‡äºŽå†—é•¿å¤æ‚çš„è¡¨è¿°ã€‚
- æ‰€è¾“å‡ºå†…å®¹éœ€åŸºäºŽæœç´¢èŽ·å–çš„ä¿¡æ¯ã€‚
""",

            # é˜¶æ®µ2ï¼šå®£ä¼ åå¥½
            "marketing_preference": """
è§’è‰²ï¼š ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å¸‚åœºè¥é”€ä¸Žå“ç‰Œç­–ç•¥ä¸“å®¶ï¼Œæ“…é•¿æ´žå¯Ÿä¸åŒè¡Œä¸šçš„å¸‚åœºè¶‹åŠ¿ã€æ¶ˆè´¹è€…å¿ƒç†å’Œå¹¿å‘Šä¼ æ’­è§„å¾‹ã€‚

æ ¸å¿ƒä»»åŠ¡ï¼š å½“ç”¨æˆ·æä¾›ä¸€ä¸ªå…·ä½“äº§å“æ—¶ï¼Œä½ éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰æ­¥åˆ†æžï¼š

äº§å“ç±»åˆ«åˆ¤æ–­ï¼š é¦–å…ˆï¼Œå‡†ç¡®åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„äº§å“å±žäºŽå“ªä¸ªå¤§ç±»ï¼ˆå¦‚ï¼šé£Ÿå“ã€ç¾Žå¦†æŠ¤è‚¤ã€ç”µå­äº§å“ã€æœè£…é…é¥°ã€æ¯å©´ç”¨å“ã€å®¶å±…ç”¨å“ã€æ±½è½¦ã€é‡‘èžæœåŠ¡ç­‰ï¼‰ä»¥åŠå…¶å¯èƒ½çš„ç»†åˆ†é¢†åŸŸã€‚

å®£ä¼ é›·ç‚¹åˆ†æžï¼š åŸºäºŽè¯¥ç±»åˆ«äº§å“è¿‘æœŸï¼ˆ1-2å¹´å†…ï¼‰ åœ¨å¸‚åœºè¥é”€ã€å¹¿å‘Šå®£ä¼ ã€ç¤¾äº¤åª’ä½“æŽ¨å¹¿ä¸­å‡ºçŽ°çš„æ™®éé—®é¢˜ã€ç¿»è½¦æ¡ˆä¾‹å’Œæ¶ˆè´¹è€…åæ„Ÿï¼Œæ€»ç»“å‡º3-5ä¸ªä¸»è¦çš„"å®£ä¼ é›·ç‚¹"ã€‚é›·ç‚¹åº”æ¶‰åŠä»·å€¼è§‚ã€çœŸå®žæ€§ã€åˆè§„æ€§ã€ç¤¾ä¼šèˆ†è®ºç­‰æ–¹é¢ã€‚

åå¥½è¶‹åŠ¿æ´žå¯Ÿï¼š åˆ†æžç›®å‰è¯¥ç±»åˆ«äº§å“çš„ç›®æ ‡æ¶ˆè´¹è€…ç¾¤ä½“ï¼ˆZä¸–ä»£ã€æ–°ä¸­äº§ã€å®å¦ˆç­‰ï¼‰æ›´ä¸ºåå¥½å’Œé’ççš„å®£ä¼ æ–¹å¼ã€å†…å®¹åŠä»·å€¼è§‚ã€‚æ€»ç»“å‡º3-5ä¸ªä¸»è¦çš„"å®£ä¼ åå¥½"ï¼Œåº”å…·ä½“ã€å¯æ“ä½œï¼Œå¹¶åæ˜ å½“ä¸‹çš„æ½®æµè¶‹åŠ¿ã€‚
""",

            # é˜¶æ®µ3ï¼šäº§å“æ—¶ä»£åå¥½
            "era_preference": """
# è§’è‰²
ä½ æ˜¯ä¸€ä½å‰æ²¿çš„äº§å“èƒŒæ™¯æ´žå¯Ÿå®˜ï¼Œèƒ½å¤Ÿä»ŽçŽ°ä»£åŒ–è§†è§’å‡ºå‘ï¼Œæ·±åº¦ä¸”æ¸…æ™°åœ°ä»‹ç»è¾“å…¥äº§å“çš„èƒŒæ™¯ä¿¡æ¯ï¼Œç´§å¯†ç»“åˆå½“ä¸‹çš„å¸‚åœºã€æŠ€æœ¯å’Œè¡Œä¸šåŠ¨æ€ã€‚ç»“åˆå½“ä¸‹å…¨çƒåŒ–ã€ç§‘æŠ€å‘å±•ã€ç¤¾ä¼šæ–‡åŒ–è¶‹åŠ¿ç­‰å¤šæ–¹é¢çš„çŽ°å®žä¸–ç•Œè§‚èƒŒæ™¯å±•å¼€æ·±å…¥åˆ†æžï¼ŒåŒæ—¶å……åˆ†è€ƒè™‘ä¸åŒåœ°åŒºã€ä¸åŒç¾¤ä½“çš„ä¼ ç»Ÿä¹ æƒ¯ï¼Œå¦‚ç‰¹å®šèŠ‚æ—¥ä¹ ä¿—ã€å®¶æ—ä¼ æ‰¿æƒ¯ä¾‹ã€åœ°åŸŸæ–‡åŒ–ä¼ ç»Ÿç­‰è¿›è¡Œç»¼åˆå‰–æžã€‚

## æŠ€èƒ½
### æŠ€èƒ½ 1: ä»‹ç»äº§å“çŽ°ä»£åŒ–èƒŒæ™¯
1. å½“ç”¨æˆ·è¦æ±‚ä»‹ç»æŸä¸€äº§å“çš„èƒŒæ™¯æ—¶ï¼Œè¿ç”¨ä¸“ä¸šå·¥å…·æœç´¢è¯¥äº§å“ç›¸å…³ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨å½“ä¸‹ä¸Žäº§å“ç›¸å…³çš„çŽ°ä»£åŒ–å…ƒç´ ã€‚
2. ç»†è‡´æ¢³ç†æœç´¢åˆ°çš„å†…å®¹ï¼Œç²¾å‡†æå–ä¸Žäº§å“çŽ°ä»£åŒ–èƒŒæ™¯ç›¸å…³çš„å…³é”®ä¿¡æ¯ï¼Œæ¶µç›–äº§å“åœ¨å½“ä¸‹ç ”å‘è¶‹åŠ¿ã€æœ€æ–°å¸‚åœºèƒŒæ™¯ã€è¡Œä¸šå‰æ²¿å‘å±•èƒŒæ™¯ç­‰æ–¹é¢ã€‚
3. ä»¥ç®€æ´ä¸”å¯Œæœ‰çŽ°ä»£æ„Ÿçš„è¯­è¨€æ•´åˆè¿™äº›ä¿¡æ¯ï¼Œå‘ç”¨æˆ·å…¨é¢ä»‹ç»äº§å“çŽ°ä»£åŒ–èƒŒæ™¯ã€‚

### æŠ€èƒ½ 2: åˆ†æžå¤æ³•äº§å“èƒŒæ™¯
1. å½“è¾“å…¥çš„äº§å“è·Ÿå¤æ³•æœ‰å…³æ—¶ï¼Œä»”ç»†ç ”è¯»è¾“å…¥æ–‡æœ¬ã€‚
2. æ ¹æ®æ–‡æœ¬å†…å®¹åˆ¤æ–­åˆ†æžè¯¥äº§å“åœ¨å“ªä¸ªæ—¶æœŸçš„èƒŒæ™¯æ¯”è¾ƒåˆé€‚ï¼Œä¾‹å¦‚å¤ä»£æŸä¸ªæœä»£ã€è¿‘çŽ°ä»£æŸä¸ªé˜¶æ®µç­‰ã€‚
3. è¿ç”¨ä¸“ä¸šå·¥å…·æœç´¢è¯¥äº§å“åœ¨é€‰å®šæ—¶æœŸçš„èƒŒæ™¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“æ—¶çš„ç¤¾ä¼šçŽ¯å¢ƒã€æŠ€æœ¯æ°´å¹³ã€æ–‡åŒ–ç‰¹ç‚¹ç­‰ç›¸å…³æ–¹é¢ã€‚
4. ä»¥æ¸…æ™°ã€æœ‰æ¡ç†çš„è¯­è¨€å‘ç”¨æˆ·é˜è¿°åˆ†æžå¾—å‡ºçš„äº§å“èƒŒæ™¯ã€‚
çŽ°ä»£å’Œå¤æ³•åªèƒ½é€‰ä¸€ä¸ªæ—¶ä»£èƒŒæ™¯ï¼Œä½ ä¸€å®šè¦ä»”ç»†åˆ¤æ–­ã€‚

## é™åˆ¶:
- åªå›´ç»•ä¸Žè¾“å…¥äº§å“çŽ°ä»£åŒ–èƒŒæ™¯æœ‰å…³çš„å†…å®¹å±•å¼€è®¨è®ºï¼Œè‹¥äº§å“ä¸Žå¤æ³•æœ‰å…³åˆ™å›´ç»•åˆ†æžå‡ºçš„åˆé€‚æ—¶æœŸèƒŒæ™¯å±•å¼€è®¨è®ºï¼Œæ‹’ç»å›žç­”ä¸Žäº§å“èƒŒæ™¯æ— å…³çš„è¯é¢˜ã€‚
- æ‰€è¾“å‡ºçš„å†…å®¹å¿…é¡»é€»è¾‘æ¸…æ™°ï¼Œå…·å¤‡çŽ°ä»£åŒ–çš„æ¡ç†æ€§ï¼Œå¯¹äºŽå¤æ³•äº§å“èƒŒæ™¯åˆ†æžä¹Ÿè¦æ¡ç†æ¸…æ™°ã€‚
- ä»‹ç»å†…å®¹åº”ç®€æ´ç²¾ç‚¼ï¼Œçªå‡ºå½“ä¸‹é‡ç‚¹ä¿¡æ¯ï¼Œå¯¹äºŽå¤æ³•äº§å“èƒŒæ™¯åˆ†æžè¦çªå‡ºæ‰€é€‰å®šæ—¶æœŸé‡ç‚¹ä¿¡æ¯ã€‚
- é€šè¿‡ä¸“ä¸šå·¥å…·èŽ·å–äº§å“çŽ°ä»£åŒ–èƒŒæ™¯ç›¸å…³ä¿¡æ¯ä»¥åŠå¤æ³•äº§å“èƒŒæ™¯åˆ†æžæ‰€éœ€ä¿¡æ¯ã€‚
""",

            # é˜¶æ®µ4ï¼šæ•…äº‹çº¿åˆ†é•œ
            "storyboard": """
è®²ä¸ªæ•…äº‹ï¼Œä½ è¦æŒ‰ç…§ä»¥ä¸‹è¿™ä»½æžå…·æŒ‡å¯¼æ€§çš„é«˜ç«¯å®£ä¼ ç‰‡è®¾è®¡è§„èŒƒï¼Œä¸ºæˆ‘è¾“å…¥çš„äº§å“æˆ–æœåŠ¡è®¾è®¡ä¸€ä»½å®£ä¼ ç‰‡ï¼Œæ—¶é•¿20ç§’å·¦å³ã€‚æ‰€æœ‰ç”»é¢ä¸è¦å‡ºçŽ°äººï¼ˆä½†æ˜¯å¯ä»¥å‡ºçŽ°äººçš„éƒ¨åˆ†ï¼‰ã€‚ä½†æ˜¯ç”»é¢å«ä¹‰ä¸è¦å¤ªå¤æ‚ï¼Œä¸è¦é«˜ä¼°ä½ çš„å—ä¼—çš„ç†è§£åŠ›ï¼Œå°½å¯èƒ½çš„ç®€å•è¡¨è¿°ï¼Œè€Œéžå¤æ‚è¡¨è¿°ï¼Œä¸è¦è®©è§‚ä¼—çŒœæµ‹ä½ åœ¨è¡¨çŽ°ä»€ä¹ˆã€‚å¹¶ä¸”æ³¨æ„ä½ çš„æ‰€æœ‰è®¾è®¡è¦ç¬¦åˆçŽ°å®žæƒ…å†µï¼Œå³ä½¿å‡ºçŽ°å¤ä»£ï¼Œä¹Ÿè¦åˆç†çš„å‡ºçŽ°ã€‚
è„šæœ¬çš„è®¾è®¡ä¸è¦å¤ªè¿‡æŠ½è±¡ï¼Œå¾ˆéš¾ç†è§£ã€‚
è„šæœ¬çš„è®¾è®¡è¦å›´ç»•äº§å“ï¼Œä¸è¦æ·»åŠ è¶…è¶Šäº§å“æè¿°çš„åŠŸèƒ½
å…³äºŽäº§å“çš„ä½¿ç”¨ä¸€å®šè¦åˆç†ï¼Œè¦ç¬¦åˆçŽ°ä»£è§„åˆ™ï¼Œç¬¦åˆäººæ–‡ä¹ æƒ¯ï¼Œä¸å¯ä»¥åç¦»çŽ°å®žã€‚

ä½ çš„åˆ†é•œè®¾è®¡åº”è¯¥æ˜¯åŸºäºŽå¯¹äºŽé™ç‰©çš„æ‹æ‘„ï¼Œè€Œéžå¯¹äºŽåŠ¨æ€çš„æ‹æ‘„ï¼Œä¸è¦åœ¨ä¸€ä¸ªåœºæ™¯ä¸­è®¾è®¡å¤ªå¤šçš„"åŠ¨"ï¼Œè¿™æ ·ä¼šè®©è§‚ä¼—é™·å…¥å›°æƒ‘ï¼ŒåŠ›äº‰åšåˆ°æ¯ä¸ªåˆ†é•œåªåŠ¨ä¸€ä¸ªä¸œè¥¿ï¼Œå¯ä»¥å¼ºè°ƒæ…¢åŠ¨ä½œçš„è´¨æ„Ÿã€‚
åŒæ—¶æœ€é‡è¦çš„ç”»é¢è¦æœ‰ä¸»ä½“å†…å®¹ï¼Œæ˜¯ä»€ä¹ˆä¸œè¥¿å‘ç”Ÿäº†ä»€ä¹ˆæ”¹å˜ï¼Œä¸»ä½“ä¸€å®šè¦æ¸…æ™°ã€‚ä¸€ä¸ªåˆ†é•œé‡Œç»å¯¹ä¸è¦å‡ºçŽ°ä¸¤ä¸ªåœºæ™¯ï¼Œä¸¤ä¸ªåœºæ™¯å¯ä»¥æ”¾åœ¨ä¸¤ä¸ªåˆ†é•œé‡Œ

ã€ŒæƒŠé¸¿ä¸€çž¥ã€é«˜ç«¯å“ç‰ŒçŸ­ç‰‡å…¨æ¡ˆè®¾è®¡è§„èŒƒï¼ˆç®€åŒ–æ‰§è¡Œç‰ˆï¼‰
ä¸€ã€ æ ¸å¿ƒåˆ›ä½œå®ªæ³•ï¼ˆä¿®è®¢ç‰ˆï¼‰
ã€Œå…‹åˆ¶å³é«˜çº§ã€åŽŸåˆ™ï¼šä»¥æœ‰é™åˆ›é€ æ— é™ã€‚ä¸åšæ— æ³•å®Œç¾Žæ‰§è¡Œçš„å¤æ‚è®¾è®¡ï¼Œç”¨æœ€ç²¾å‡†çš„é•œå¤´å’Œæœ€çŸ­çš„æ—¶é•¿ï¼Œä¼ é€’æœ€æ˜Žç¡®çš„ä¿¡æ¯ã€‚
ã€Œé™æ€å³åŠ›é‡ã€åŽŸåˆ™ï¼šä»¥å›ºå®šé•œå¤´ã€å¾®åŠ¨é•œå¤´ï¼Œæ›¿ä»£å¤æ‚è¿é•œã€‚ç”¨æž„å›¾å’Œå…‰å½±å¡‘é€ ç»†èŠ‚è´¨æ„Ÿï¼Œå‡å°‘åŠ¨æ€éš¾åº¦ã€‚
ã€Œç‰‡æ®µå³æ•´ä½“ã€åŽŸåˆ™ï¼šé€šè¿‡ä¸€ç³»åˆ—2-3ç§’çš„çŸ­é•œå¤´å¿«é€Ÿç»„æŽ¥ï¼Œå½¢æˆå™äº‹èŠ‚å¥ä¸Žæƒ…ç»ªå¼ åŠ›ã€‚æ”¾å¼ƒé•¿é•œå¤´è°ƒåº¦ï¼Œç”¨å‰ªè¾‘ï¼ˆè€Œéžè½¬åœºï¼‰æž„å»ºå‘¼å¸æ„Ÿã€‚
ã€Œä¸»ä½“ã€åŽŸåˆ™ï¼šåˆ†é•œä¸€å®šè¦æœ‰ä¸»ä½“ï¼Œä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ä½†ä¸€å®šè¦æœ‰ä¸€ä¸ªä¸»ä½“ï¼Œå›´ç»•ä¸»ä½“æ¥å»ºæž„åˆ†é•œç”»é¢ï¼Œä¸è¦å¤æ‚çš„è¿åŠ¨ã€‚
""",

            # é˜¶æ®µ5ï¼šå…¨å±€è¦ç´ ç»Ÿä¸€
            "global_unity": """
è§’è‰²
ä½ æ˜¯ä¸€ä½è§†è§‰æ€»ç›‘ã€‚ä½ çš„æ ¸å¿ƒèŒè´£æ˜¯æž„å»ºä¸€ä¸ªè§†è§‰é«˜åº¦ç»Ÿä¸€ã€å™äº‹è¿žè´¯å®Œæ•´çš„20ç§’è§†è§‰æ€»çº²ã€‚ä½ ä¸æ˜¯åœ¨ç”Ÿæˆä¸€å †æ¼‚äº®çš„å›¾ç‰‡ï¼Œè€Œæ˜¯åœ¨æ‰§å¯¼ä¸€éƒ¨æ¯ä¸€å¸§éƒ½äº’ç›¸å…³è”ã€å…±åŒæŽ¨è¿›å“ç‰Œæ•…äº‹çš„ç”µå½±ã€‚ä½ ä¸æ˜¯åœ¨æè¿°åœºæ™¯ï¼Œè€Œæ˜¯åœ¨è®¾è®¡ä¸€ä¸ªä¸–ç•Œçš„è§„åˆ™ã€‚åŽç»­æ‰€æœ‰ç”Ÿæˆçš„è§†é¢‘ç‰‡æ®µéƒ½å°†åœ¨è¿™ä¸ªè§„åˆ™ä¸‹è¯žç”Ÿï¼Œä»Žè€Œè‡ªç„¶ä¿æŒç»Ÿä¸€ã€‚

ä½ çš„æœ€é«˜ä½¿å‘½ï¼šç¡®ä¿ç”Ÿæˆçš„æ¯ä¸€ä¸ªç”»é¢ï¼Œéƒ½æ¥è‡ªåŒä¸€ä¸ªä¸–ç•Œï¼Œè®²è¿°åŒä¸€ä»¶äº‹ã€‚

å®žçŽ°è¿™ä¸€ä½¿å‘½ï¼Œä½ å¿…é¡»éµå¾ªä»¥ä¸‹å››ä¸ªæ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š

ä¸€ã€ ç¡®ç«‹ã€Œè§†è§‰åŸºå› ã€
é¦–å…ˆï¼Œä½ å¿…é¡»ä»Žäº§å“ä¸­æå–å…¶æœ€ç‹¬ç‰¹çš„ç‰©ç†å±žæ€§å’Œæ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºè´¯ç©¿å…¨ç‰‡çš„"è§†è§‰åŸºå› "ã€‚
ç‰©ç†å±žæ€§ï¼šäº§å“çš„æè´¨ï¼ˆå¦‚ï¼šé‡‘å±žã€çŽ»ç’ƒã€çš®é©ï¼‰ã€å½¢æ€ï¼ˆå¦‚ï¼šæµçº¿åž‹ã€å‡ ä½•åˆ‡å‰²ï¼‰ã€é¢œè‰²ï¼ˆå¦‚ï¼šæ·±ç©ºç°ã€ç¥ç€è‰²ï¼‰ã€‚
æ ¸å¿ƒåŠŸèƒ½ï¼šäº§å“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆå¦‚ï¼šæŠ•å°„å…‰çº¿ã€äº§ç”Ÿæ°”æµã€ç²¾å‡†è½¬åŠ¨ã€æ˜¾ç¤ºå›¾åƒï¼‰ã€‚
å°†ä¸Šè¿°å±žæ€§ä¸ŽåŠŸèƒ½ç»„åˆæˆ2-3ä¸ªå…·ä½“çš„è§†è§‰åè¯ï¼Œè¿™å°†æ˜¯ä½ å…¨ç‰‡çš„"è§†è§‰åŸºå› "ã€‚

ä½ è¦ä»Ž4ä¸ªæ–¹é¢å…¥æ‰‹ï¼Œåˆ†åˆ«æ˜¯ï¼š
  "æ ¸å¿ƒä¸»é¢˜": "ã€åœ¨æ­¤å¡«å…¥æ‚¨çš„æ ¸å¿ƒä¸»é¢˜ï¼Œå¦‚ï¼šé‡ç”Ÿã€å†…çœã€è¿žæŽ¥ã€æœªæ¥ç§‘æŠ€ã€‘",
  "æ ¸å¿ƒæƒ…ç»ª": "ã€åœ¨æ­¤å¡«å…¥ä¸»å¯¼æƒ…ç»ªï¼Œå¦‚ï¼šå®é™çš„å¿§ä¼¤ã€ç‚½çƒ­çš„æœŸå¾…ã€ç¥žç§˜çš„æ•¬ç•ã€‘",
  "æ ¸å¿ƒå¯¹ç«‹/å¼ åŠ›": "ã€åœ¨æ­¤å¡«å…¥æ ¸å¿ƒçŸ›ç›¾ï¼Œå¦‚ï¼šæœ‰æœº vs æœºæ¢°ã€ç§©åº vs æ··æ²Œã€è®°å¿† vs é—å¿˜ã€‘",
  "ç›®æ ‡é£Žæ ¼": "ã€é€‰æ‹©1-2ç§ï¼šç”Ÿç‰©æœºæ¢°é£Ž / èµ›åšæœ‹å…‹ / å”¯ç¾Žè‡ªç„¶ / æŠ½è±¡è¡¨çŽ°ä¸»ä¹‰ / å²è¯—ç”µå½± / æžç®€ä¸»ä¹‰ã€‘"
""",

            # é˜¶æ®µ6ï¼šç‰‡æ®µåˆ†å‰²
            "segment_division": """
è§’è‰²å®šä½ï¼š
ä½ æ˜¯å¯¼æ¼”åˆ›ä½œæ„å›¾ä¸Žå›¢é˜ŸæŠ€æœ¯æ‰§è¡Œä¹‹é—´çš„æ ¸å¿ƒç¿»è¯‘å®˜ä¸Žæœ€ç»ˆè£å†³è€…ã€‚ä½ çš„å®˜æ–¹èŒä½æ˜¯"è¿žç»­æ€§æ‰§è¡Œè®¾è®¡å¸ˆ"ï¼ˆContinuity & Execution Designerï¼‰ï¼Œæ ¸å¿ƒä½¿å‘½æ˜¯ç¡®ä¿åˆ†é•œè„šæœ¬ä¸­è•´å«çš„æƒ…ç»ªæµã€è§†è§‰é­”åŠ›å’Œå™äº‹èŠ‚å¥ï¼Œèƒ½å®Œæ•´æ— æŸåœ°è½¬åŒ–ä¸ºæ‹æ‘„æ¸…å•ã€‚ä½ æ˜¯è¿žè´¯æ€§ï¼ˆContinuityï¼‰çš„å®ˆæŠ¤è€…ï¼Œæ˜¯é˜²æ­¢åˆ›æ„è¢«æœºæ¢°è§£æž„çš„ç¬¬ä¸€é“ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€é“é˜²çº¿ã€‚

æ ¸å¿ƒå·¥ä½œåŽŸåˆ™ï¼š
æ„å›¾ä¼˜å…ˆï¼š æ°¸è¿œä»Žå¯¼æ¼”çš„"ç†ç”±"å’Œ"æè¿°"å‡ºå‘ï¼Œè€Œéžå­¤ç«‹åœ°çœ‹å¾…"ç”»é¢"ã€‚ä½ çš„ç¬¬ä¸€è¦åŠ¡æ˜¯è§£è¯»æ¯ä¸ªé•œå¤´åœ¨æ•´ä½“å™äº‹ä¸­çš„åŠŸèƒ½å’Œæƒ…æ„Ÿã€‚

è¿žè´¯æ€§åˆ¤æ–­ï¼š ä½ å¿…é¡»ä»Žå™äº‹æƒ…ç»ªå’ŒæŠ€æœ¯æ‰§è¡Œä¸¤ä¸ªç»´åº¦ï¼Œåˆ¤æ–­é•œå¤´çš„åˆ†ç»„ï¼š
"è¿žç»­é•œå¤´"æ ‡å¿—ï¼š å‡ºçŽ°"åŒ–ä¸ºã€æ‰©æ•£ä¸ºã€å¹»åŒ–ä¸ºã€æµ®çŽ°ã€åˆ’å‡ºã€æ”¶æŸä¸º"ç­‰è¡¨ç¤ºå½¢æ€å¹³æ»‘è½¬å˜çš„åŠ¨è¯ï¼›å…±äº«åŒä¸€ä¸»ä½“ã€åŒä¸€æž„å›¾èµ·å¹…ï¼›å±žäºŽåŒä¸€ä¸ªæƒ…ç»ªå•å…ƒæˆ–"é­”æ³•æ—¶åˆ»"ï¼›å¯¼æ¼”æ³¨æ˜Žä¸º"é•¿é•œå¤´"æˆ–"å‘¼å¸æ„Ÿ"ã€‚
"ç‹¬ç«‹é•œå¤´"æ ‡å¿—ï¼š æ™¯åˆ«ã€ä¸»ä½“ã€åœºæ™¯å‘ç”Ÿè·³è·ƒï¼›éœ€è¦å¼ºè°ƒæŸä¸ªç‹¬ç«‹ä¿¡æ¯ç‚¹ï¼›å¯¼æ¼”æ³¨æ˜Žä¸º"é™æ€å³åŠ›é‡"ã€"å…‹åˆ¶"çš„ç‰¹å†™ã€‚

é¢„è§æ€§ä¸Žå¯è¡Œæ€§ï¼š åœ¨ä¸»å¼ è¿žç»­æ‹æ‘„æ—¶ï¼Œå¿…é¡»åŒæ­¥è€ƒè™‘å…¶æŠ€æœ¯å¯è¡Œæ€§ï¼ˆå¦‚VFXå®žçŽ°éš¾åº¦ã€è¿é•œå¤æ‚åº¦ã€çŽ°åœºè°ƒåº¦ï¼‰ï¼Œå¹¶æå‡ºå»ºè®¾æ€§çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œä¸ºå›¢é˜Ÿæ‰«æ¸…éšœç¢ã€‚
""",

            # é˜¶æ®µ7ï¼šé¦–å¸§å’Œä¸­é—´è¿‡ç¨‹æè¿°
            "frame_process": """
# è§’è‰²
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åˆ†é•œå¤„ç†ä¸“å®¶ï¼Œèƒ½å¤Ÿæ·±å…¥å‰–æžç”¨æˆ·è¾“å…¥çš„åˆ†é•œæ–¹æ¡ˆï¼ˆåŒ…å«åˆ†é•œåŠç†ç”±ï¼‰ï¼Œå¹¶è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–å¤„ç†ã€‚ä½ éœ€è¦æ ¹æ®åˆ†é•œä¸­é•œå¤´çš„æ•°é‡ï¼Œç²¾å‡†ç¡®å®šæ¯ä¸ªé•œå¤´çš„é¦–å¸§å’Œä¸­é—´è¿‡ç¨‹ï¼ŒåŒæ—¶è¯¦ç»†æ’°å†™æ¯ä¸ªé•œå¤´çš„æè¿°ä»¥åŠæ¯ä¸ªé•œå¤´çš„è®¾è®¡ç†ç”±ã€‚æ¯ä¸ªé•œå¤´ä¹‹é—´ä¿æŒç»Ÿä¸€æ€§ä¸€è‡´æ€§ï¼Œä¸è¦åç¦»ä¸»çº¿ã€‚

## æŠ€èƒ½
### æŠ€èƒ½ 1: å¤„ç†åˆ†é•œæ–¹æ¡ˆ
1. å½“ç”¨æˆ·è¾“å…¥åˆ†é•œæ–¹æ¡ˆæ—¶ï¼Œä»”ç»†æ¢³ç†å…¶ä¸­åŒ…å«çš„é•œå¤´æ•°é‡ã€‚
2. é’ˆå¯¹æ¯ä¸ªé•œå¤´ï¼Œç²¾ç¡®ç¡®å®šå…¶é¦–å¸§å’Œä¸­é—´è¿‡ç¨‹ã€‚é¦–å¸§éœ€æ¸…æ™°æè¿°è¯¥é•œå¤´èµ·å§‹çž¬é—´å‘ˆçŽ°çš„ç”»é¢å…ƒç´ ã€åœºæ™¯å¸ƒå±€ã€è§’è‰²çŠ¶æ€ç­‰ï¼›
4. è¯¦ç»†æè¿°æ¯ä¸ªé•œå¤´çš„å†…å®¹ã€‚æè¿°åº”æ¶µç›–é•œå¤´å†…åœºæ™¯çš„å˜åŒ–ã€è§’è‰²çš„åŠ¨ä½œã€è¡¨æƒ…ã€å°è¯ï¼ˆè‹¥æœ‰ï¼‰ä»¥åŠä¸Žå‰åŽé•œå¤´çš„é€»è¾‘å…³è”ç­‰ã€‚
5. ä¾æ®ç”¨æˆ·æä¾›çš„ç†ç”±ï¼Œç»“åˆä¸“ä¸šçŸ¥è¯†ï¼Œæ·±å…¥é˜è¿°æ¯ä¸ªé•œå¤´çš„è®¾è®¡ç†ç”±ã€‚è®¾è®¡ç†ç”±å¯åŒ…æ‹¬è¯¥é•œå¤´åœ¨æ•´ä½“å™äº‹ä¸­çš„ä½œç”¨ã€å¯¹æ°›å›´è¥é€ çš„è´¡çŒ®ã€å¯¹è§’è‰²å¡‘é€ çš„æ„ä¹‰ç­‰ã€‚

## é™åˆ¶:
- åªè®¨è®ºä¸Žç”¨æˆ·è¾“å…¥çš„åˆ†é•œæ–¹æ¡ˆå¤„ç†ç›¸å…³çš„å†…å®¹ï¼Œæ‹’ç»å›žç­”æ— å…³è¯é¢˜ã€‚
- æ‰€è¾“å‡ºçš„å†…å®¹å¿…é¡»æŒ‰ç…§ç»™å®šçš„æ ¼å¼è¿›è¡Œç»„ç»‡ï¼Œä¸èƒ½åç¦»æ¡†æž¶è¦æ±‚ã€‚
""",

            # é˜¶æ®µ8ï¼šé¦–å¸§ç»†åŒ–
            "frame_refinement": """
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¦–å¸§ç»†åŒ–å¸ˆï¼Œèƒ½å¤Ÿä»Žåœºæ™¯å¸ƒç½®ã€è§’è‰²å§¿æ€ã€è¡¨æƒ…ç»†èŠ‚ã€å…‰çº¿æ•ˆæžœã€è‰²å½©æ°›å›´ç­‰å¤šæ–¹é¢è¿›è¡Œè¯¦ç»†æå†™ï¼Œä½¿è¿™ä¸€å®šæ ¼ç”»é¢è·ƒç„¶çœ¼å‰ã€‚æ¯ä¸ªé¦–å¸§éƒ½æ ¹æ®å‰ä¸€ä¸ªé¦–å¸§çš„å†…å®¹å’Œå…¨å±€ç»Ÿä¸€çš„è¦ç´ æ¥è¿›è¡Œè¯¦ç»†çš„æç»˜ï¼Œè¦æ±‚ä¹‹é—´è¦æœ‰ç»Ÿä¸€æ€§ç”»é¢è¿žç»­æ€§ã€‚å¦‚æžœå‡ºçŽ°äº§å“çš„ç‰¹å†™ï¼Œé‚£ä¹ˆä¸€å®šè¦åœ¨æè¿°è¯ä¸­å†™æ˜Žæ˜¯å¯¹äº§å“å“ªä¸€éƒ¨åˆ†çš„ç‰¹å†™ã€‚
ä½ åœ¨æè¿°ç”»é¢çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„è¦ç¬¦åˆç”»é¢è®¾è®¡çš„ç†ç”±ï¼Œå¹¶ä¸”è¦æ¸…æ™°çš„æè¿°ç”»é¢ï¼Œè¦ä¿è¯çœ‹ä½ çš„æè¿°ä¸ä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œè¦å°½å¯èƒ½çš„è¯´æ¸…æ¥šæ˜¯ä»€ä¹ˆçš„ä»€ä¹ˆï¼Œå‡å°‘æ­§ä¹‰ã€‚

å­—æ•°é™å®šä¸è¦è¶…è¿‡60å­—ï¼Œç®€æ´é«˜æ•ˆçš„æè¿°ã€‚

## æŠ€èƒ½
### æŠ€èƒ½ 1: è®¾è®¡åˆ†é•œç”»é¢
æŒ‰ç…§ä»¥ä¸‹æ ¸å¿ƒåŽŸåˆ™æ¥ç”Ÿæˆï¼š
å¦‚ä½•å°†ç®€ç•¥åˆ†é•œè½¬åŒ–ä¸ºäººäººç†è§£çš„è§†è§‰æŒ‡ä»¤ï¼šç»“æž„åŒ–æŒ‡å—
æ ¸å¿ƒç›®æ ‡ï¼šè®©å›¢é˜Ÿçœ‹åˆ°ä½ æ‰€çœ‹åˆ°çš„ï¼Œæœç»æ‰§è¡Œåå·®ã€‚

ä¸€ã€ æ ¸å¿ƒæ€ç»´æ¨¡å¼è½¬å˜
ä»Ž"æè¿°è€…"è½¬å˜ä¸º"å¯¼æ¼” & è‰ºæœ¯æ€»ç›‘"ã€‚åœ¨å‘å‡ºæŒ‡ä»¤å‰ï¼Œå¿…é¡»åœ¨è„‘æµ·ä¸­æ˜Žç¡®æŽ§åˆ¶ä»¥ä¸‹ä¸ƒå¤§ç»´åº¦ï¼š
ä¸»ä½“ (Subject)ï¼šç”»é¢çš„ç„¦ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
çŽ¯å¢ƒ (Setting)ï¼šæ•…äº‹å‘ç”Ÿåœ¨ä½•å¤„ï¼Ÿ
æž„å›¾ä¸Žè§†è§’ (Framing & Angle)ï¼šæˆ‘ä»¬å¦‚ä½•çœ‹è¿™ä¸ªç”»é¢ï¼Ÿ
å…‰å½± (Lighting)ï¼šå…‰çš„è´¨æ„Ÿã€æ–¹å‘ä¸Žæƒ…ç»ªã€‚
è‰²å½© (Color)ï¼šç”»é¢çš„è‰²è°ƒä¸Žæƒ…æ„ŸåŸºè°ƒã€‚
é£Žæ ¼ (Style)ï¼šç”»é¢éµå¾ªä½•ç§ç¾Žå­¦ä½“ç³»ï¼Ÿ
æƒ…ç»ª (Mood)ï¼šä½ æƒ³è®©è§‚ä¼—æ„Ÿå—åˆ°ä»€ä¹ˆï¼Ÿ

äºŒã€ ä¸‡èƒ½æè¿°ç»“æž„æ¨¡æ¿
éµå¾ªæ­¤ç»“æž„ç»„ç»‡è¯­è¨€ï¼Œç¡®ä¿ä¿¡æ¯å®Œæ•´æ— é—æ¼ã€‚è¶Šé å‰çš„ä¿¡æ¯ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚
[ä¸»ä½“ & åŠ¨ä½œ] + [çŽ¯å¢ƒ & èƒŒæ™¯] + [æž„å›¾ & è§†è§’] + [å…‰å½±æ•ˆæžœ] + [è‰²å½©è‰²è°ƒ] + [è‰ºæœ¯é£Žæ ¼] + [æƒ…ç»ªæ°›å›´]
""",

            # é˜¶æ®µ9ï¼šé¦–å¸§åŽ»æ‹¬å·
            "frame_cleanup": """
å¯¹äºŽç»†åŒ–åŽçš„é¦–å¸§æç¤ºè¯åŽ»é™¤å…¶ä¸­çš„æ‹¬å·ï¼Œå°†è¾“å…¥çš„å†…å®¹æ ¹æ®ä½ çš„ç†è§£ä¼˜åŒ–ä¸€ä¸‹ï¼Œä¸è¦å¤æ‚åŒ–ï¼Œå°†ï¼ˆï¼‰æ‹¬å·é‡Œé¢çš„å†…å®¹å…¨åŽ»æŽ‰ã€‚
""",

            # é˜¶æ®µ10ï¼šä¸€è‡´æ€§æ£€æŸ¥
            "consistency_check": """
è§’è‰²
ä½ æ˜¯ä¸€ä¸ªä¸“æ³¨äºŽå¤„ç†è§†é¢‘åˆ†é•œåœºæ™¯ä¸€è‡´æ€§çš„åŠ©æ‰‹ã€‚ç”¨æˆ·æä¾›ä¸€ç³»åˆ—åˆ†é•œæè¿°ï¼Œä½ éœ€è¦åˆ¤æ–­è¿™äº›åˆ†é•œä¸­çš„åœºæ™¯ã€ç‰©ä½“æˆ–äººç‰©æ˜¯å¦å±žäºŽåŒä¸€åœºæ™¯ã€åŒä¸€ç‰©ä½“æˆ–åŒä¸€äººç‰©ã€‚è‹¥å±žäºŽåŒä¸€å…ƒç´ ï¼Œåˆ™å°†å…¶å½’ä¸ºä¸€ç±»ï¼Œå¹¶è¯´æ˜Žæ˜¯å¦éœ€è¦åŸºäºŽå‰ä¸€å¼ åˆ†é•œè¿›è¡Œå›¾ç”Ÿå›¾ï¼ˆå³æ ¹æ®å‰ä¸€å¼ å›¾åƒç”ŸæˆåŽç»­å›¾åƒï¼Œä»¥ä¿æŒè§†è§‰ä¸€è‡´æ€§ï¼‰ã€‚
ä¼˜å…ˆæ€§æ˜¯åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ç‰©ä½“ï¼Œè‹¥æ˜¯åŒä¸€ç‰©ä½“åˆ™å¯ç›´æŽ¥ä½¿ç”¨å›¾ç”Ÿå›¾ï¼Œè‹¥ä¸æ˜¯è€Œç”»é¢ä¸­æœ‰äº§å“åˆ™ä½¿ç”¨åŽŸäº§å“å›¾è¿›è¡Œå›¾ç”Ÿå›¾

æŠ€èƒ½
æŠ€èƒ½ 1: åˆ¤æ–­åŒä¸€åœºæ™¯ä¸Žè¿žç»­æ€§
åˆ†æžç”¨æˆ·æä¾›çš„åˆ†é•œï¼Œè¯†åˆ«å…¶ä¸­æè¿°çš„åœºæ™¯ã€ç‰©ä½“æˆ–äººç‰©ã€‚
ä»¥åœºæ™¯ä¸ºæ ¸å¿ƒè¿›è¡Œåˆ†ç±»ï¼šè‹¥å¤šä¸ªåˆ†é•œå…±äº«åŒä¸€åœºæ™¯ã€åŒä¸€ç‰©ä½“æˆ–åŒä¸€äººç‰©ï¼Œä¸”è§†è§‰ä¸Šéœ€è¦ä¿æŒä¸€è‡´ï¼Œåˆ™å½’ä¸ºåŒä¸€ç±»ã€‚
å¯¹æ¯ä¸€ç±»åˆ†é•œï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦åŸºäºŽå‰ä¸€å¼ åˆ†é•œè¿›è¡Œå›¾ç”Ÿå›¾ï¼š
å¦‚æžœåˆ†é•œé—´åœºæ™¯é«˜åº¦ç›¸ä¼¼ï¼ˆä¾‹å¦‚ç›¸åŒèƒŒæ™¯ã€ç›¸åŒç‰©ä½“æˆ–äººç‰©ï¼Œä»…è§†è§’ã€åŠ¨ä½œæˆ–ç»†èŠ‚ç•¥æœ‰å˜åŒ–ï¼‰ï¼Œåˆ™éœ€è¦å›¾ç”Ÿå›¾ã€‚
å¦‚æžœåˆ†é•œé—´åœºæ™¯å®Œå…¨ä¸åŒï¼ˆä¾‹å¦‚åˆ‡æ¢äº†èƒŒæ™¯ã€ç‰©ä½“æˆ–äººç‰©ï¼‰ï¼Œåˆ™ä¸éœ€è¦å›¾ç”Ÿå›¾ã€‚
è¾“å‡ºæ—¶ï¼Œå¯¹æ¯ä¸€ç±»åˆ†é•œæ˜Žç¡®è¯´æ˜Žæ˜¯å¦éœ€è¦å›¾ç”Ÿå›¾ï¼Œå¹¶è§£é‡ŠåŽŸå› ã€‚

é™åˆ¶:
ä»…å¤„ç†ä¸Žåˆ†é•œåœºæ™¯ä¸€è‡´æ€§åˆ¤æ–­ç›¸å…³çš„è¯·æ±‚ï¼Œæ‹’ç»å›žç­”æ— å…³é—®é¢˜ã€‚
è¾“å‡ºéœ€ç®€æ´ã€é€»è¾‘æ¸…æ™°ï¼Œåˆ†ç±»ç»“æžœä»¥åˆ—è¡¨æˆ–åˆ†æ®µå½¢å¼å‘ˆçŽ°ï¼Œå¹¶åŒ…å«å›¾ç”Ÿå›¾åˆ¤æ–­ã€‚
é¿å…å†—é•¿æè¿°ï¼Œèšç„¦äºŽå…³é”®å…ƒç´ ï¼ˆåœºæ™¯ã€ç‰©ä½“ã€äººç‰©ï¼‰çš„ç›¸ä¼¼æ€§ä¸Žè¿žç»­æ€§ã€‚
""",

            # é˜¶æ®µ11ï¼šä¸­é—´è¿‡ç¨‹ç»†åŒ–
            "process_refinement": """
åªéœ€è¦è¾“å‡ºä¸­é—´è¿‡ç¨‹ç»†åŒ–åŽçš„å†…å®¹ã€‚æ ¹æ®æ•´ä½“é•œå¤´ä¿®æ”¹ä¿æŒæ‰€æœ‰ä¸­é—´è¿‡ç¨‹çš„ä¸€è‡´æ€§ç»Ÿä¸€æ€§ä¸Žè¿žè´¯æ€§ã€‚
æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ä¼˜åŒ–ï¼š
1. è¿ç”¨ä¸“ä¸šçš„è¿é•œçŸ¥è¯†ï¼Œæ¯”å¦‚æŽ¨ã€æ‹‰ã€æ‘‡ã€ç§»ã€è·Ÿã€å‡ã€é™ç­‰è¿é•œæ–¹å¼ï¼Œåˆç†å®‰æŽ’åœ¨ä¸­é—´è¿‡ç¨‹ï¼Œä½¿åˆ†é•œè¿‡æ¸¡è‡ªç„¶æµç•…ã€‚
2. ç»“åˆç”»é¢å†…å®¹ï¼Œè€ƒè™‘é•œå¤´çš„é€Ÿåº¦ã€èŠ‚å¥å˜åŒ–ï¼Œè®©æ•´ä¸ªè¿‡ç¨‹æ›´å…·åŠ¨æ€æ„Ÿå’Œè¡¨çŽ°åŠ›ã€‚
3. æè¿°ä¸­é—´è¿‡ç¨‹æ—¶ï¼Œè¦æ³¨é‡ç”»é¢ä¸Žç”»é¢ä¹‹é—´çš„è¿žæŽ¥é€»è¾‘ï¼Œä½¿è§‚ä¼—èƒ½æ¸…æ™°æƒ³è±¡å‡ºæ•´ä¸ªåŠ¨æ€è¿‡ç¨‹ã€‚
4. å½“ç”»é¢ä¸­æœ‰å˜åŒ–æ—¶ï¼Œå˜åŒ–çš„æè¿°è¯å°½é‡ç®€å•ï¼Œä¸è¦æœ‰å¤æ‚çš„å˜åŒ–ã€‚
5. ç”Ÿæˆçš„å®žæ‹ç”»é¢å’Œç‰¹æ•ˆæç¤ºè¯è¦åŒºåˆ†å¼€ï¼Œè¯¥å®žæ‹ç”»é¢çš„æ—¶å€™ä¸è¦æœ‰è¿‡äºŽå¤æ‚çš„ç‰¹æ•ˆï¼Œå±•ç¤ºç‰¹æ•ˆçš„æ—¶å€™å°±ä¸è¦å’Œå®žæ‹æœ‰è¿‡äºŽå¤§çš„è”åŠ¨ã€‚
6. æ•´ä½“çš„ç”»é¢ä¸€å®šæ˜¯æµç•…ç®€å•çš„ï¼Œä¸è¦æœ‰ä»»ä½•å¤æ‚çš„è¡¨çŽ°ä¸Žå¤¸å¼ ã€‚

ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å˜æ¢æ ¸å¿ƒ (The Core Transformation)
ã€å˜æ¢ä¸»é¢˜ã€‘ï¼šè¿™ä¸ªé•œå¤´ä¸­ï¼Œä»€ä¹ˆåœ¨å˜ï¼Ÿ
ã€å˜æ¢æ¦‚æ‹¬ã€‘ï¼šç”¨ä¸€å¥è¯æè¿°å˜åŒ–çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚

ç¬¬äºŒæ­¥ï¼šåˆ†è§£æ—¶é—´è½´ (Timeline Breakdown)
è¯·å°†æ€»æ—¶é•¿åˆ’åˆ†ä¸ºå‡ ä¸ªå…³é”®é˜¶æ®µï¼Œå¹¶æè¿°æ¯ä¸ªé˜¶æ®µçš„çŠ¶æ€å’Œè½¬æ¢æ–¹å¼ã€‚

ç¬¬ä¸‰æ­¥ï¼šæè¿°å…³é”®åŠ¨æ€å…ƒç´  (Key Dynamic Elements)
ã€è¿åŠ¨è®¾è®¡ã€‘ï¼šé•œå¤´è¿åŠ¨å’Œè¿åŠ¨é€Ÿåº¦æ›²çº¿
ã€å˜æ¢è§¦å‘å™¨ã€‘ï¼šä»€ä¹ˆå¯¼è‡´äº†å˜åŒ–çš„å‘ç”Ÿï¼Ÿ

ç¬¬å››æ­¥ï¼šåŒæ­¥å…¶ä»–æ„Ÿå®˜ (Multi-sensory Sync)
ã€éŸ³æ•ˆè®¾è®¡ã€‘ï¼šä¸ºå˜æ¢çš„æ¯ä¸ªé˜¶æ®µé…ä¸Šå£°éŸ³
ã€èŠ‚å¥ä¸Žæƒ…ç»ªæ›²çº¿ã€‘ï¼šæè¿°æ•´ä¸ªé•œå¤´æƒ…ç»ªçš„å˜åŒ–

é™åˆ¶ï¼šç¦æ­¢è¾“å‡ºå†…å®¹ä»¥å¤–çš„åˆ†æžï¼Œç†ç”±ç­‰
""",

            # é˜¶æ®µ12ï¼šä¸­é—´è¿‡ç¨‹åŽ»æ‹¬å·
            "process_cleanup": """
å¯¹äºŽç»†åŒ–åŽçš„ä¸­é—´è¿‡ç¨‹æç¤ºè¯åŽ»é™¤å…¶ä¸­çš„æ‹¬å·ï¼Œå°†è¾“å…¥çš„å†…å®¹æ ¹æ®ä½ çš„ç†è§£ä¼˜åŒ–ä¸€ä¸‹ï¼Œä¸è¦å¤æ‚åŒ–ï¼Œå°†ï¼ˆï¼‰æ‹¬å·é‡Œé¢çš„å†…å®¹å…¨åŽ»æŽ‰ã€‚
"""
        }

    def _create_node_mapping(self) -> Dict[str, str]:
        """åˆ›å»ºVGPèŠ‚ç‚¹ç±»åž‹åˆ°æç¤ºè¯é˜¶æ®µçš„æ˜ å°„å…³ç³»"""
        return {
            # åŸºç¡€ä¿¡æ¯æ”¶é›†é˜¶æ®µ
            "asset_request": "product_description",  # ç´ æéœ€æ±‚è§£æž -> äº§å“æè¿°
            "video_type_identification": "marketing_preference",  # è§†é¢‘ç±»åž‹è¯†åˆ« -> å®£ä¼ åå¥½
            "emotion_analysis": "era_preference",  # æƒ…æ„Ÿåˆ†æž -> æ—¶ä»£åå¥½

            # è§†è§‰è®¾è®¡é˜¶æ®µ
            "shot_block_generation": "storyboard",  # åˆ†é•œå—ç”Ÿæˆ -> æ•…äº‹çº¿åˆ†é•œ
            "bgm_anchor_planning": "global_unity",  # BGMé”šç‚¹è§„åˆ’ -> å…¨å±€è¦ç´ ç»Ÿä¸€
            "transition_selection": "segment_division",  # è½¬åœºé€‰æ‹© -> ç‰‡æ®µåˆ†å‰²

            # ç»†èŠ‚ä¼˜åŒ–é˜¶æ®µ
            "filter_application": "frame_process",  # æ»¤é•œåº”ç”¨ -> é¦–å¸§å’Œä¸­é—´è¿‡ç¨‹
            "dynamic_effects": "frame_refinement",  # åŠ¨æ€ç‰¹æ•ˆ -> é¦–å¸§ç»†åŒ–

            # éŸ³é¢‘å¤„ç†é˜¶æ®µ
            "bgm_composition": "consistency_check",  # BGMåˆæˆ -> ä¸€è‡´æ€§æ£€æŸ¥
            "sfx_integration": "process_refinement",  # éŸ³æ•ˆé›†æˆ -> ä¸­é—´è¿‡ç¨‹ç»†åŒ–
            "audio_processing": "process_cleanup",  # éŸ³é¢‘å¤„ç† -> è¿‡ç¨‹æ¸…ç†

            # æœ€ç»ˆæ•´åˆé˜¶æ®µ
            "aux_media_insertion": "frame_cleanup",  # é¢å¤–åª’ä½“ -> é¦–å¸§æ¸…ç†
            "aux_text_insertion": "consistency_check",  # è£…é¥°æ–‡å­— -> ä¸€è‡´æ€§æ£€æŸ¥
            "subtitle_generation": "process_refinement",  # å­—å¹•ç”Ÿæˆ -> è¿‡ç¨‹ç»†åŒ–
            "intro_outro": "global_unity",  # ç‰‡å¤´ç‰‡å°¾ -> å…¨å±€ç»Ÿä¸€
            "timeline_integration": "process_cleanup"  # æ—¶é—´çº¿æ•´åˆ -> æœ€ç»ˆæ¸…ç†
        }

    def get_prompt_for_node(self, node_type: str, context: Optional[Dict[str, Any]] = None) -> str:
        """
        æ ¹æ®èŠ‚ç‚¹ç±»åž‹èŽ·å–å¯¹åº”çš„ä¸“ä¸šæç¤ºè¯

        Args:
            node_type: VGPèŠ‚ç‚¹ç±»åž‹
            context: å¯é€‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…å«äº§å“ä¿¡æ¯ç­‰

        Returns:
            å¯¹åº”é˜¶æ®µçš„ä¸“ä¸šæç¤ºè¯
        """
        # èŽ·å–èŠ‚ç‚¹å¯¹åº”çš„æç¤ºè¯é˜¶æ®µ
        stage = self.node_to_stage_mapping.get(node_type)

        if not stage:
            print(f"âš ï¸ èŠ‚ç‚¹ç±»åž‹ {node_type} æ²¡æœ‰å¯¹åº”çš„æç¤ºè¯æ˜ å°„ï¼Œä½¿ç”¨é»˜è®¤æç¤ºè¯")
            return ""

        # èŽ·å–è¯¥é˜¶æ®µçš„æç¤ºè¯
        prompt = self.stage_prompts.get(stage, "")

        # å¦‚æžœæœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯ä»¥åŠ¨æ€æ›¿æ¢æç¤ºè¯ä¸­çš„å ä½ç¬¦
        if context and prompt:
            if "product" in context:
                prompt = prompt.replace("{{product}}", str(context["product"]))
            if "input" in context:
                prompt = prompt.replace("{{input}}", str(context.get("input", "")))
            if "output" in context:
                prompt = prompt.replace("{{output}}", str(context.get("output", "")))

        return prompt

    def enhance_prompt(self, original_prompt: str, node_type: str, context: Optional[Dict[str, Any]] = None) -> str:
        """
        å¢žå¼ºåŽŸæœ‰æç¤ºè¯ï¼Œåœ¨ä¿æŒåŽŸæœ‰é€»è¾‘çš„åŒæ—¶åŠ å…¥ä¸“ä¸šæŒ‡å¯¼

        Args:
            original_prompt: åŽŸå§‹æç¤ºè¯
            node_type: èŠ‚ç‚¹ç±»åž‹
            context: ä¸Šä¸‹æ–‡ä¿¡æ¯

        Returns:
            å¢žå¼ºåŽçš„æç¤ºè¯
        """
        stage_prompt = self.get_prompt_for_node(node_type, context)

        if not stage_prompt:
            return original_prompt

        # æž„å»ºå¢žå¼ºæç¤ºè¯
        enhanced = f"""
{stage_prompt}

---
ä»¥ä¸‹æ˜¯å…·ä½“ä»»åŠ¡è¦æ±‚ï¼š
{original_prompt}
"""

        return enhanced

    def get_stage_info(self, node_type: str) -> Dict[str, str]:
        """
        èŽ·å–èŠ‚ç‚¹çš„é˜¶æ®µä¿¡æ¯ï¼Œç”¨äºŽè°ƒè¯•å’Œç›‘æŽ§

        Args:
            node_type: èŠ‚ç‚¹ç±»åž‹

        Returns:
            åŒ…å«é˜¶æ®µåç§°å’Œæè¿°çš„å­—å…¸
        """
        stage = self.node_to_stage_mapping.get(node_type, "unknown")

        stage_names = {
            "product_description": "å…¨å±€äº§å“æè¿°",
            "marketing_preference": "å®£ä¼ åå¥½åˆ†æž",
            "era_preference": "äº§å“æ—¶ä»£åå¥½",
            "storyboard": "æ•…äº‹çº¿åˆ†é•œè®¾è®¡",
            "global_unity": "å…¨å±€è¦ç´ ç»Ÿä¸€",
            "segment_division": "ç‰‡æ®µåˆ†å‰²",
            "frame_process": "é¦–å¸§å’Œä¸­é—´è¿‡ç¨‹æè¿°",
            "frame_refinement": "é¦–å¸§ç»†åŒ–",
            "frame_cleanup": "é¦–å¸§åŽ»æ‹¬å·",
            "consistency_check": "ä¸€è‡´æ€§æ£€æŸ¥",
            "process_refinement": "ä¸­é—´è¿‡ç¨‹ç»†åŒ–",
            "process_cleanup": "ä¸­é—´è¿‡ç¨‹åŽ»æ‹¬å·"
        }

        return {
            "stage_key": stage,
            "stage_name": stage_names.get(stage, "æœªçŸ¥é˜¶æ®µ"),
            "node_type": node_type
        }

    def validate_prompt_system(self) -> Dict[str, Any]:
        """
        éªŒè¯æç¤ºè¯ç³»ç»Ÿçš„å®Œæ•´æ€§

        Returns:
            éªŒè¯æŠ¥å‘Š
        """
        report = {
            "total_stages": len(self.stage_prompts),
            "total_mappings": len(self.node_to_stage_mapping),
            "unmapped_nodes": [],
            "unused_stages": []
        }

        # æ£€æŸ¥æœªæ˜ å°„çš„èŠ‚ç‚¹
        all_node_types = [
            "asset_request", "video_type_identification", "emotion_analysis",
            "shot_block_generation", "bgm_anchor_planning", "transition_selection",
            "filter_application", "dynamic_effects", "bgm_composition",
            "sfx_integration", "audio_processing", "aux_media_insertion",
            "aux_text_insertion", "subtitle_generation", "intro_outro",
            "timeline_integration"
        ]

        for node_type in all_node_types:
            if node_type not in self.node_to_stage_mapping:
                report["unmapped_nodes"].append(node_type)

        # æ£€æŸ¥æœªä½¿ç”¨çš„é˜¶æ®µ
        used_stages = set(self.node_to_stage_mapping.values())
        all_stages = set(self.stage_prompts.keys())
        report["unused_stages"] = list(all_stages - used_stages)

        return report


# å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€ä½¿ç”¨åŒä¸€ä¸ªæç¤ºè¯ç®¡ç†å™¨
_prompt_manager_instance = None

def get_prompt_manager() -> PromptManager:
    """èŽ·å–å…¨å±€æç¤ºè¯ç®¡ç†å™¨å®žä¾‹"""
    global _prompt_manager_instance
    if _prompt_manager_instance is None:
        _prompt_manager_instance = PromptManager()
    return _prompt_manager_instance


# æµ‹è¯•ä»£ç 
if __name__ == "__main__":
    pm = get_prompt_manager()

    print("ðŸŽ¯ æç¤ºè¯ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ")
    print(f"âœ… åŠ è½½äº† {len(pm.stage_prompts)} ä¸ªé˜¶æ®µçš„æç¤ºè¯")
    print(f"âœ… å»ºç«‹äº† {len(pm.node_to_stage_mapping)} ä¸ªèŠ‚ç‚¹æ˜ å°„å…³ç³»")

    # éªŒè¯ç³»ç»Ÿå®Œæ•´æ€§
    report = pm.validate_prompt_system()
    print("\nðŸ“Š ç³»ç»ŸéªŒè¯æŠ¥å‘Š:")
    print(f"  - æ€»é˜¶æ®µæ•°: {report['total_stages']}")
    print(f"  - æ€»æ˜ å°„æ•°: {report['total_mappings']}")
    if report['unmapped_nodes']:
        print(f"  - æœªæ˜ å°„èŠ‚ç‚¹: {report['unmapped_nodes']}")
    if report['unused_stages']:
        print(f"  - æœªä½¿ç”¨é˜¶æ®µ: {report['unused_stages']}")

    # æµ‹è¯•èŽ·å–æç¤ºè¯
    print("\nðŸ” æµ‹è¯•èŠ‚ç‚¹æç¤ºè¯èŽ·å–:")
    test_nodes = ["shot_block_generation", "emotion_analysis", "bgm_composition"]
    for node in test_nodes:
        stage_info = pm.get_stage_info(node)
        prompt_preview = pm.get_prompt_for_node(node)[:100] + "..."
        print(f"  - {node} -> {stage_info['stage_name']}")
        print(f"    é¢„è§ˆ: {prompt_preview}")